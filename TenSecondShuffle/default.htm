<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Ten Second Shuffle</title>

    <!-- Global RuleSet Definitions -->
    <script src="js/GlobalRuleSet.js" type="text/ecmascript"></script>

    <!-- Graphics Engine and Sprite Tree -->
    <script src="js/DrawingContext2D.js" type="text/ecmascript"></script>
    <script src="js/Sprite.js" type="text/ecmascript"></script>
    <script src="js/GameHostSprite.js" type="text/ecmascript"></script>
    <script src="js/GameRootSprite.js" type="text/ecmascript"></script>
    <script src="js/FrameSprite.js" type="text/ecmascript"></script>
    <script src="js/ImageSprite.js" type="text/ecmascript"></script>

    <!-- Game Common -->
    <script src="js/Game.js" type="text/ecmascript"></script>

    <!-- Click Sequence Game -->
    <script src="js/ClickSequence/ClickSequenceGame.js" type="text/ecmascript"></script>
    <script src="js/ClickSequence/ClickSequenceSprite.js" type="text/ecmascript"></script>
    
    <script>
        var games = [
            { id: "Click Sequence", constructor: ClickSequenceGame, instance: null, rootSprite: null },
            // { id: "Block Breaker", constructor: BlockBreaker, instance: null, rootSprite: null },
            // { id: "Arkanoid", constructor: Arkanoid, instance: null, rootSprite: null }
        ];

        var drawingContext;

        function init() {
            drawingContext = new DrawingContext2D(document.getElementById("renderTarget"));

            // Builds out the base sprite tree which contains the background layers, game host and HUD.
            setupSpriteTree();

            requestAnimationFrame(render);
        }

        function setupSpriteTree() {
            var rootSprite = new Sprite(0, 0, null);
            this.drawingContext.rootSprite = rootSprite;

            // Layer tree
            rootSprite.addNamedChild("backgroundLayer", new Sprite(0, 0, null));

            var activationContext = {
                renderTargetElement: document.getElementById("renderTarget"),
                menu: null,
                services: null
            };
            rootSprite.addNamedChild("gameHostLayer", new GameHostSprite(activationContext, 0, 0));
            rootSprite.addNamedChild("hudLayer", new Sprite(0, 0, null));

            // Background Layer Setup

            // Hud Layer Setup
            this.hudElement = new ImageSprite(this.drawingContext.width / 2, this.drawingContext.height / 2, this.imgSquare);
            rootSprite.hudLayer.addChild(this.hudElement);

            // Game Setup
            for (var i = 0; i < games.length; i++) {
                var gameDescriptor = games[i];

                // Connect the game descriptor to a root sprite and and game instance
                gameDescriptor.rootSprite = new GameRootSprite(0, 0);
                gameDescriptor.instance = new gameDescriptor.constructor(gameDescriptor.rootSprite);

                // Initialize the game root sprite and game
                gameDescriptor.rootSprite.init(gameDescriptor.instance);
                gameDescriptor.instance.init();

                // Attach the game root sprite to the game host sprite
                rootSprite.gameHostLayer.addChild(gameDescriptor.rootSprite);
            }
        }

        function render() {
            update();
            draw();

            requestAnimationFrame(render);
        }

        function update() {

            // Pass updates through the visual sprite tree, a GameRootSprite will talk to the game itself.
            this.drawingContext.rootSprite.hudLayer.x = Math.cos(new Date() / 1000) * 100;
            this.drawingContext.rootSprite.hudLayer.y = Math.sin(new Date() / 1000) * 100;

            this.drawingContext.rootSprite.update();
        }

        function draw() {
            this.drawingContext.beginDraw();
            this.drawingContext.clear();
            this.drawingContext.rootSprite.draw(this.drawingContext);
            this.drawingContext.endDraw();
        }
    </script>
</head>
<body onload="init();">
    <h1>
        <center>Welcome to Ludum Dare 27 and Ten Second Shuffle</center>
    </h1>

    <canvas id="renderTarget" width="1024" height="768" style="background-color: white;"></canvas>

    <div style="display: none">
        <img id="imgSquare" src="images/stock/square.png" />
    </div>
</body>
</html>
